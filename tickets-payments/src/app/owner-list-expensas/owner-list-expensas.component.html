<div class="container">
  <h2 class="mt-4">Hola Propietario</h2>
  <p>Aca podras visualizar el listado de expensas sus detalles</p>
  <hr class="my-4">
  <div class="row  d-flex mb-3 justify-content-center">
    <div class="col-md-6 justify-content-center">
      <label for="searchInput" class="form-label mb-0">Buscador general</label>
      <input type="text" class="form-control" id="searchInput" [(ngModel)]="searchText" (input)="searchTable()" placeholder="Escribe para buscar...">
    </div>

    <form [formGroup]="fechasForm" class="col-md-6 justify-content-center">
      <div class="row g-3 justify-content-center align-items-end"> 
        <div class="col-md-4">
          <label for="fechaInicio" class="form-label mb-0">Fecha Inicio</label>
          <input type="date" class="form-control" formControlName="fechaInicio" id="fechaInicio">
        </div>
        <div class="col-md-4">
          <label for="fechaFin" class="form-label mb-0">Fecha Fin</label>
          <input type="date" class="form-control" formControlName="fechaFin" id="fechaFin">
        </div>
        <div class="col-md-4">
          <button class="btn btn-dark" type="button" (click)="enviarFechas()">Buscar</button>
        </div>
      </div>
    </form>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th scope="col" class="text-center">Propietario</th>
        <th scope="col" class="text-center">Periodo</th>
        <th scope="col" class="text-center">TOTAL</th>
        <th scope="col" class="text-center">Estado</th>
        <th scope="col" class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      @for (item of filteredTickets; track $index) {

      <tr>
        <th scope="row" class="text-center">{{item.owner_id}}</th>
        <td class="text-center">{{item.emision_date | date:'MM/YYYY'}}</td>
        <td class="text-center">{{ calculateTotal(item) | currency }}</td>
        <td class="text-center">
          <span class="badge" [ngClass]="{
                    'bg-success': item.status === 'PAID',
                    'bg-danger': item.status === 'CANCELED',
                    'bg-warning': item.status === 'PENDING'
                  }">
            {{ item.status }}
          </span>
        </td>

        <td class="text-center"><button type="button" class="btn btn-primary" data-bs-toggle="modal"
            data-bs-target="#ticketModal" (click)="selectTicket(item)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-printer-fill" viewBox="0 0 16 16">
              <path
                d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1">
              </path>
              <path
                d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1">
              </path>
            </svg>
          </button></td>
      </tr>

      }


    </tbody>
  </table>
</div>



<!-- Modal -->
<div class="modal fade" id="ticketModal" tabindex="-1" aria-labelledby="ticketModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ticketModalLabel">Factura - Ticket N째 {{ ticketSelectedModal.id }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <strong>Dirigido a:</strong> {{ ticketSelectedModal.owner_id }}
          </div>
          <div class="col-md-6 text-end">
            <strong>Fecha de emisi처n:</strong> {{ ticketSelectedModal.emision_date | date: 'dd/MM/yyyy' }}<br>
            <strong>Fecha de expiraci처n:</strong> {{ ticketSelectedModal.expiration_date | date: 'dd/MM/yyyy' }}
          </div>
        </div>
        <hr>

        <table class="table table-bordered">
          <thead class="table-warning">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Descripci처n</th>
              <th scope="col">Cantidad</th>
              <th scope="col">Precio Unitario</th>
              <th scope="col">Costo Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of ticketSelectedModal?.items; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ item.name }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.price | currency }}</td>
              <td>{{ (item.quantity * item.price) | currency }}</td>
            </tr>
          </tbody>
        </table>

        <div class="row">
          <div class="col-md-6">
            <strong>Estado:</strong>
            <span [ngClass]="{
                'badge bg-success': ticketSelectedModal.status === 'PAID',
                'badge bg-danger': ticketSelectedModal.status === 'CANCELED',
                'badge bg-warning': ticketSelectedModal.status === 'PENDING'
              }">
              {{ ticketSelectedModal.status }}
            </span>
          </div>
          <div class="col-md-6 text-end">
            <strong>Total:</strong> {{ calculateTotal(ticketSelectedModal) | currency }}
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button type="button" class="btn btn-primary" (click)="pagar()">Pagar</button>
        <div id="wallet_container"></div>

      </div>
    </div>
  </div>
</div>